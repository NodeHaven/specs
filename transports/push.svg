<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="735px" preserveAspectRatio="none" style="width:1150px;height:735px;" version="1.1" viewBox="0 0 1150 735" width="1150px" zoomAndPan="magnify"><defs><filter height="300%" id="f1muspx1z6xbgn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="433.5" y="23.5352">Uport Push Notification Architecture v2</text><rect fill="#EDECFF" height="689.9453" style="stroke: #6959DB; stroke-width: 1.0;" width="427.5" x="579.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="741.25" y="47.0566">Uport Servicess</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="105.2422" style="stroke: #EDECFF; stroke-width: 2.0;" width="474.5" x="13" y="133.9766"/><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="75.9316" style="stroke: #EDECFF; stroke-width: 2.0;" width="1126" x="13" y="253.2188"/><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="277.7949" style="stroke: #EDECFF; stroke-width: 2.0;" width="1126" x="13" y="343.1504"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="68" x2="68" y1="116.9766" y2="637.9453"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="205" x2="205" y1="116.9766" y2="637.9453"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="416.5" x2="416.5" y1="116.9766" y2="637.9453"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="659.5" x2="659.5" y1="116.9766" y2="637.9453"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="980" x2="980" y1="116.9766" y2="637.9453"/><line style="stroke: #878787; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1076" x2="1076" y1="116.9766" y2="637.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="23" y="114.0234">UportMobile</text><ellipse cx="68.5" cy="43.4883" fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" rx="8" ry="8" style="stroke: #6959DB; stroke-width: 2.0;"/><path d="M68.5,51.4883 L68.5,78.4883 M55.5,59.4883 L81.5,59.4883 M68.5,78.4883 L55.5,93.4883 M68.5,78.4883 L81.5,93.4883 " fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" style="stroke: #6959DB; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="23" y="650.4805">UportMobile</text><ellipse cx="68.5" cy="663.4336" fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" rx="8" ry="8" style="stroke: #6959DB; stroke-width: 2.0;"/><path d="M68.5,671.4336 L68.5,698.4336 M55.5,679.4336 L81.5,679.4336 M68.5,698.4336 L55.5,713.4336 M68.5,698.4336 L81.5,713.4336 " fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" style="stroke: #6959DB; stroke-width: 2.0;"/><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="138" x="134" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="141" y="102.0234">Apple Push Server</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="138" x="134" y="636.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="141" y="657.4805">Apple Push Server</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="97" x="366.5" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="373.5" y="102.0234">AmazonSNS</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="97" x="366.5" y="636.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="373.5" y="657.4805">AmazonSNS</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="129" x="593.5" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="600.5" y="102.0234">UportPushServer</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="129" x="593.5" y="636.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="600.5" y="657.4805">UportPushServer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="957" y="114.0234">Inbox</text><path d="M962,64.4883 C962,54.4883 980,54.4883 980,54.4883 C980,54.4883 998,54.4883 998,64.4883 L998,90.4883 C998,100.4883 980,100.4883 980,100.4883 C980,100.4883 962,100.4883 962,90.4883 L962,64.4883 " fill="#FEFECE" filter="url(#f1muspx1z6xbgn)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M962,64.4883 C962,74.4883 980,74.4883 980,74.4883 C980,74.4883 998,74.4883 998,64.4883 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="957" y="650.4805">Inbox</text><path d="M962,663.4336 C962,653.4336 980,653.4336 980,653.4336 C980,653.4336 998,653.4336 998,663.4336 L998,689.4336 C998,699.4336 980,699.4336 980,699.4336 C980,699.4336 962,699.4336 962,689.4336 L962,663.4336 " fill="#FEFECE" filter="url(#f1muspx1z6xbgn)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M962,663.4336 C962,673.4336 980,673.4336 980,673.4336 C980,673.4336 998,673.4336 998,663.4336 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="82" x="1033" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1040" y="102.0234">ClientApp</text><rect fill="#FFFFFF" filter="url(#f1muspx1z6xbgn)" height="30.4883" rx="5" ry="5" style="stroke: #6959DB; stroke-width: 1.5;" width="82" x="1033" y="636.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1040" y="657.4805">ClientApp</text><rect fill="none" height="105.2422" style="stroke: #EDECFF; stroke-width: 2.0;" width="474.5" x="13" y="133.9766"/><polygon fill="#6959DB" points="13,133.9766,189,133.9766,189,140.9766,179,150.9766,13,150.9766,13,133.9766" style="stroke: #EDECFF; stroke-width: 2.0;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="28" y="147.5449">Mobile Registration</text><polygon fill="#6959DB" points="79.5,168.2871,69.5,172.2871,79.5,176.2871,75.5,172.2871" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="73.5" x2="204" y1="172.2871" y2="172.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="85.5" y="167.8555">Device Token</text><polygon fill="#6959DB" points="405,197.5977,415,201.5977,405,205.5977,409,201.5977" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="68.5" x2="411" y1="201.5977" y2="201.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="75.5" y="197.166">Device Token</text><polygon fill="#6959DB" points="79.5,226.9082,69.5,230.9082,79.5,234.9082,75.5,230.9082" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="73.5" x2="416" y1="230.9082" y2="230.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="85.5" y="226.4766">Endpoint ARN</text><rect fill="none" height="75.9316" style="stroke: #EDECFF; stroke-width: 2.0;" width="1126" x="13" y="253.2188"/><polygon fill="#6959DB" points="13,253.2188,223,253.2188,223,260.2188,213,270.2188,13,270.2188,13,253.2188" style="stroke: #EDECFF; stroke-width: 2.0;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="28" y="266.7871">App Request Permission</text><polygon fill="#6959DB" points="79.5,287.5293,69.5,291.5293,79.5,295.5293,75.5,291.5293" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="73.5" x2="1075" y1="291.5293" y2="291.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="85.5" y="287.0977">Selective Disclosure Request Token</text><polygon fill="#6959DB" points="1064,316.8398,1074,320.8398,1064,324.8398,1068,320.8398" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="68.5" x2="1070" y1="320.8398" y2="320.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="75.5" y="316.4082">Push Token (containing Endpoint ARN)</text><rect fill="none" height="277.7949" style="stroke: #EDECFF; stroke-width: 2.0;" width="1126" x="13" y="343.1504"/><polygon fill="#6959DB" points="13,343.1504,150,343.1504,150,350.1504,140,360.1504,13,360.1504,13,343.1504" style="stroke: #EDECFF; stroke-width: 2.0;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="28" y="356.7188">Send Request</text><polygon fill="#6959DB" points="671,377.4609,661,381.4609,671,385.4609,667,381.4609" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="665" x2="1075" y1="381.4609" y2="381.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="677" y="377.0293">PushToken and Encrypted Request</text><polygon fill="#6959DB" points="968,406.7715,978,410.7715,968,414.7715,972,410.7715" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="660" x2="974" y1="410.7715" y2="410.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="667" y="406.3398">Store Encrypted Request and return message id</text><line style="stroke: #6959DB; stroke-width: 1.0;" x1="660" x2="702" y1="440.3926" y2="440.3926"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="702" x2="702" y1="440.3926" y2="453.3926"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="661" x2="702" y1="453.3926" y2="453.3926"/><polygon fill="#6959DB" points="671,449.3926,661,453.3926,671,457.3926,667,453.3926" style="stroke: #6959DB; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="667" y="435.6504">Extract Endpoint ARN from Push Token</text><polygon fill="#6959DB" points="428,478.3926,418,482.3926,428,486.3926,424,482.3926" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="422" x2="659" y1="482.3926" y2="482.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="434" y="477.9609">Push message id and EndpointARN</text><polygon fill="#6959DB" points="216,507.7031,206,511.7031,216,515.7031,212,511.7031" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="210" x2="416" y1="511.7031" y2="511.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="222" y="507.2715">Message ID and Device Token</text><polygon fill="#6959DB" points="79.5,537.0137,69.5,541.0137,79.5,545.0137,75.5,541.0137" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="73.5" x2="204" y1="541.0137" y2="541.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="85.5" y="536.582">Message ID</text><polygon fill="#6959DB" points="79.5,566.3242,69.5,570.3242,79.5,574.3242,75.5,570.3242" style="stroke: #6959DB; stroke-width: 1.0;"/><polygon fill="#6959DB" points="968,566.3242,978,570.3242,968,574.3242,972,570.3242" style="stroke: #6959DB; stroke-width: 1.0;"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="73.5" x2="974" y1="570.3242" y2="570.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="85.5" y="565.8926">Fetch Message</text><line style="stroke: #6959DB; stroke-width: 1.0;" x1="68.5" x2="110.5" y1="599.9453" y2="599.9453"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="110.5" x2="110.5" y1="599.9453" y2="612.9453"/><line style="stroke: #6959DB; stroke-width: 1.0;" x1="69.5" x2="110.5" y1="612.9453" y2="612.9453"/><polygon fill="#6959DB" points="79.5,608.9453,69.5,612.9453,79.5,616.9453,75.5,612.9453" style="stroke: #6959DB; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="75.5" y="595.2031">Decrypt Message</text><!--
@startuml
skinparam roundcorner 10
skinparam BoxPadding 10
skinparam headerFontColor #6959DB
skinparam headerFontSize 18
skinparam sequence {
  ArrowColor #6959DB
  GroupBackgroundColor #6959DB
  GroupBorderColor #EDECFF
  GroupHeaderFontColor #ffffff
  BoxBorderColor #6959DB
  BoxBackgroundColor #EDECFF
  BoxPadding 10

  ParticipantBorderColor #6959DB
  ParticipantBackgroundColor #ffffff
  ParticipantPadding 10

  ActorBorderColor #6959DB
  ActorBackgroundColor #ffffff
  EntityBorderColor #6959DB
  EntityBackgroundColor #ffffff
  DatabaseBorderColor #6959DB
  DatabaseBackgroundColor #ffffff

  LifeLineBorderColor #878787
}

title Uport Push Notification Architecture v2
actor UportMobile
participant "Apple Push Server" as APNS
participant AmazonSNS
box "Uport Servicess"
  participant UportPushServer
  database Inbox
end box
participant ClientApp

group Mobile Registration
  UportMobile <- APNS : Device Token
  UportMobile -> AmazonSNS: Device Token
  AmazonSNS -> UportMobile: Endpoint ARN
end

group App Request Permission
  ClientApp -> UportMobile : Selective Disclosure Request Token
  UportMobile -> ClientApp: Push Token (containing Endpoint ARN)
end

group Send Request
  ClientApp -> UportPushServer: PushToken and Encrypted Request
  UportPushServer -> Inbox: Store Encrypted Request and return message id
  UportPushServer -> UportPushServer: Extract Endpoint ARN from Push Token
  UportPushServer -> AmazonSNS: Push message id and EndpointARN
  AmazonSNS -> APNS: Message ID and Device Token
  APNS -> UportMobile : Message ID
  UportMobile <-> Inbox : Fetch Message
  UportMobile -> UportMobile : Decrypt Message
end
@enduml

PlantUML version 1.2017.19(Sun Nov 12 05:46:22 CST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_144-b01
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>